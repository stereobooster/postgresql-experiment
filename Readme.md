# Experiment with DBs and auto API generation

## PostgreSQL

We will use Docker to run everything. Because we need to run more than one docker image and this is a toy project we will use [docker compose](https://docs.docker.com/compose/gettingstarted/).

...

## External client

(optional)

[Let's connect to the database with an external client](https://www.cockroachlabs.com/docs/managed/stable/managed-connect-to-your-cluster.html).

Start compose

```
docker-compose up
```

[Use DB client of your preference](https://github.com/dhamaniasad/awesome-postgres#gui). I would use [pgcli](https://www.pgcli.com/).

```
pgcli "postgresql://postgres:password@localhost:5432/postgres"
Server: PostgreSQL 11.2
Version: 2.0.2
Chat: https://gitter.im/dbcli/pgcli
Mail: https://groups.google.com/forum/#!forum/pgcli
Home: http://pgcli.com
postgres@localhost:postgres>
```

## Sample database

Let's set up [sample database](https://stackoverflow.com/questions/5363613/sample-database-for-postgresql).

There are a lot of them (but not all work out of the box):

- https://github.com/devrimgunduz/pagila
- https://github.com/catherinedevlin/opensourceshakespeare
- http://pgfoundry.org/projects/dbsamples/
- https://musicbrainz.org/doc/MusicBrainz_Database/Download
- http://wiki.postgresql.org/wiki/Sample_Databases

I picked up [opensourceshakespeare](https://github.com/catherinedevlin/opensourceshakespeare).

```
mkdir db/dump
wget https://raw.githubusercontent.com/catherinedevlin/opensourceshakespeare/master/shakespeare.sql -O db/dump/shakespeare.sql
docker-compose up -d
  Starting db-experiment_db_1 ... done
docker exec -it db-experiment_db_1 bash
root@1539eecb5137:/# psql -U postgres postgres < tmp/dump/shakespeare.sql
root@1539eecb5137:/# exit
```

## Autogenerated API

### Postgraphile

Let's add Postgraphile. To do this we can use [official docker image](https://hub.docker.com/r/graphile/postgraphile/). But first, let's try it locally

```
npx postgraphile -n 0.0.0.0 --connection "postgresql://postgres:password@localhost:5432/postgres" --schema postgres --watch
```

### Hasura

Let's add [Hasura section to the docker compose](https://docs.hasura.io/1.0/graphql/manual/deployment/docker/index.html#step-1-get-the-docker-run-sh-bash-script).

## GraphQL explorers

### Voyager

```
npx serve -s voyager -p 5001
```

Open http://localhost:5001

### Rover

- Go to https://brbb.github.io/graphql-rover/
- Configure Endpoint url http://localhost:5000/graphql
